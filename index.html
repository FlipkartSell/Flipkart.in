<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlipKart Clone</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Base */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Roboto', Arial, sans-serif; }
        body { background-color: #f1f3f6; color: #212121; -webkit-tap-highlight-color: transparent; padding-bottom: 60px; /* Space for mobile nav */ }

        .hidden { display: none !important; }

        /* Toast Notifications */
        #toast-box {
            position: fixed;
            bottom: 70px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 90%;
            max-width: 350px;
        }

        .toast {
            background: #333;
            color: white;
            padding: 12px 16px;
            border-radius: 4px;
            font-size: 14px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            animation: slideUp 0.3s ease-out;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* Loading Overlay */
        #loading-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.9);
            z-index: 11000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #2874f0;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin-bottom: 10px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Header */
        header { background-color: #2874f0; padding: 10px 0; position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 4px rgba(0,0,0,.2); }
        .navbar { max-width: 1200px; margin: 0 auto; display: flex; align-items: center; justify-content: space-between; padding: 0 15px; }
        .logo { cursor: pointer; color: white; }
        .logo h2 { font-style: italic; font-weight: bold; margin: 0; font-size: 20px; }
        .logo p { font-size: 11px; font-style: italic; margin-top: -2px; opacity: 0.9; }
        .plus { color: #ffe500; font-weight: bold; }

        .search-bar { flex: 1; margin: 0 20px; display: flex; background: white; border-radius: 2px; padding: 5px; box-shadow: 0 1px 2px rgba(0,0,0,.2); }
        .search-bar input { width: 100%; border: none; outline: none; padding: 5px; font-size: 14px; }
        .search-bar button { background: transparent; border: none; color: #2874f0; cursor: pointer; padding: 0 10px; font-size: 16px; }

        .nav-links { display: flex; align-items: center; gap: 20px; font-weight: 600; }
        .login-btn { background: white; color: #2874f0; border: 1px solid #dbdbdb; padding: 5px 30px; font-weight: bold; cursor: pointer; border-radius: 2px; transition: 0.2s; }
        .login-btn:hover { background: #f0f0f0; }
        .nav-links a { color: white; text-decoration: none; font-size: 15px; display: flex; align-items: center; gap: 5px; cursor: pointer; }
        .cart-btn { position: relative; }
        .cart-badge { background: #ff6161; color: white; font-size: 10px; border-radius: 50%; padding: 2px 5px; position: absolute; top: -5px; right: -8px; font-weight: bold; border: 1px solid #2874f0; display: none; }

        /* Timer */
        .timer-container { background: white; padding: 12px; margin-bottom: 10px; box-shadow: 0 1px 2px rgba(0,0,0,0.1); text-align: center; border-bottom: 1px solid #eaeaea; }
        .flash-sale { background: #ff0000; color: white; padding: 3px 8px; font-size: 12px; font-weight: bold; border-radius: 3px; margin-right: 10px; vertical-align: middle; animation: pulse 1s infinite alternate; }
        @keyframes pulse { from { opacity: 0.8; } to { opacity: 1; } }
        .timer-text { font-size: 16px; color: #666; vertical-align: middle; }
        #timer { font-weight: bold; color: #333; font-family: monospace; font-size: 18px; }

        /* Category Nav */
        #category-nav { display: flex; overflow-x: auto; background: white; padding: 15px 5px; margin-bottom: 10px; box-shadow: 0 1px 2px rgba(0,0,0,0.1); scrollbar-width: none; }
        #category-nav::-webkit-scrollbar { display: none; }
        .cat-item { min-width: 80px; display: flex; flex-direction: column; align-items: center; cursor: pointer; margin: 0 10px; transition: transform 0.2s; }
        .cat-item:active { transform: scale(0.95); }
        .cat-item.active .cat-name { color: #2874f0; font-weight: bold; }
        .cat-item.active .cat-img-box { border: 2px solid #2874f0; }
        .cat-img-box { width: 60px; height: 60px; border-radius: 50%; background: #f0f0f0; overflow: hidden; margin-bottom: 8px; display: flex; justify-content: center; align-items: center; }
        .cat-img { width: 100%; height: 100%; object-fit: cover; }
        .cat-name { font-size: 12px; font-weight: 500; color: #444; text-align: center; }

        /* Banner */
        .banner-container { margin-bottom: 10px; width: 100%; overflow: hidden; }
        .banner-img { width: 100%; height: auto; border-radius: 2px; display: block; }

        /* Main */
        main { max-width: 1200px; margin: 0 auto; min-height: 80vh; padding: 10px; }
        #home-view, #product-detail-view { background: white; padding: 10px; box-shadow: 0 1px 2px rgba(0,0,0,0.1); border-radius: 2px; }

        .deals-header { display: flex; justify-content: space-between; border-bottom: 1px solid #f0f0f0; padding-bottom: 15px; margin-bottom: 15px; align-items: center; }
        .deals-header h3 { font-size: 18px; font-weight: 500; }
        .view-all { background: #2874f0; color: white; border: none; padding: 8px 16px; font-weight: bold; cursor: pointer; border-radius: 2px; font-size: 12px; }

        /* Grid */
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; }
        .product-card { border: 1px solid #f0f0f0; padding: 15px; text-align: center; cursor: pointer; transition: 0.3s; position: relative; background: white; border-radius: 4px; }
        .product-card:hover { box-shadow: 0 5px 15px rgba(0,0,0,0.1); transform: translateY(-3px); }
        .discount-badge { position: absolute; top: 10px; left: 10px; background: #388e3c; color: white; font-size: 10px; padding: 2px 6px; border-radius: 2px; font-weight: bold; }
        .product-img { height: 160px; width: 100%; object-fit: contain; margin-bottom: 10px; }
        .product-title { font-size: 14px; font-weight: 500; margin-bottom: 5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: #212121; }
        .product-rating-row { display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 4px; }
        .rating-badge { background: #388e3c; color: white; font-size: 12px; padding: 2px 6px; border-radius: 3px; font-weight: bold; display: flex; align-items: center; gap: 2px; }
        .rating-badge i { font-size: 10px; }
        .review-count { color: #878787; font-size: 12px; }
        
        /* Assured Badge */
        .assured-container { margin-bottom: 5px; }
        .assured-img { height: 18px; width: auto; margin-left: 8px; }

        .price-box { margin-top: 5px; }
        .new-price { font-size: 16px; font-weight: bold; color: #212121; }
        .old-price { font-size: 12px; color: #878787; text-decoration: line-through; margin-left: 5px; }
        .off-percent { font-size: 13px; color: #388e3c; font-weight: bold; margin-left: 5px; }

        /* Detail Page - Layout */
        .detail-container { display: flex; gap: 20px; flex-wrap: wrap; margin-top: 10px; }
        .detail-left { width: 40%; min-width: 300px; }
        .img-box { border: 1px solid #f0f0f0; padding: 20px; display: flex; justify-content: center; height: 350px; margin-bottom: 15px; background: white; }
        .img-box img { max-height: 100%; max-width: 100%; object-fit: contain; }
        
        /* Action Buttons */
        .action-buttons { display: flex; gap: 10px; }
        .action-buttons button { flex: 1; padding: 16px; color: white; border: none; font-weight: bold; font-size: 16px; cursor: pointer; border-radius: 2px; box-shadow: 0 1px 2px rgba(0,0,0,.2); display: flex; align-items: center; justify-content: center; gap: 5px; transition: 0.2s; }
        .action-buttons button:active { transform: scale(0.98); }
        .btn-cart { background: #ff9f00; }
        .btn-buy { background: #fb641b; }

        .detail-right { flex: 1; }
        .breadcrumb { font-size: 12px; color: #878787; margin-bottom: 10px; }
        #detail-title { font-size: 18px; font-weight: 400; margin-bottom: 10px; line-height: 1.4; }
        
        /* Detail Price Styling */
        .detail-price-row { display: flex; align-items: baseline; gap: 10px; margin: 10px 0; }
        .detail-discount { color: #388e3c; font-size: 16px; font-weight: bold; }
        .detail-mrp { color: #878787; font-size: 16px; text-decoration: line-through; }
        .detail-selling-price { font-size: 28px; font-weight: 500; color: #212121; }

        /* NEW: Coupon Box Style */
        .coupon-section {
            border: 1px dashed #c2c2c2;
            background-color: #f8f9fa;
            padding: 12px;
            margin: 15px 0;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .coupon-info strong { display: block; font-size: 14px; color: #212121; }
        .coupon-info span { font-size: 12px; color: #666; }
        .btn-add-coupon {
            background: white;
            border: 1px solid #e0e0e0;
            color: #2874f0;
            font-weight: bold;
            padding: 6px 16px;
            border-radius: 2px;
            cursor: pointer;
            text-transform: uppercase;
            font-size: 12px;
        }
        .btn-add-coupon.applied {
            background: #eaffea;
            border-color: #388e3c;
            color: #388e3c;
            cursor: default;
        }

        .offers ul { list-style: none; padding: 0; margin-top: 10px; }
        .offers li { font-size: 13px; margin-bottom: 8px; color: #212121; }
        .offers i { color: #388e3c; margin-right: 8px; }
        
        /* Policy Section */
        .policy-row { display: flex; gap: 20px; margin: 15px 0; border: 1px solid #f0f0f0; padding: 10px; border-radius: 4px; }
        .policy-item { display: flex; flex-direction: column; align-items: center; text-align: center; flex: 1; font-size: 12px; color: #212121; }
        .policy-icon { font-size: 20px; color: #2874f0; margin-bottom: 5px; }

        /* Specifications Table */
        .specifications-box { margin-top: 20px; border: 1px solid #f0f0f0; border-radius: 4px; overflow: hidden; }
        .spec-header { background: white; padding: 15px; font-size: 18px; font-weight: 500; color: #212121; border-bottom: 1px solid #f0f0f0; }
        .spec-row { display: flex; border-bottom: 1px solid #f0f0f0; padding: 10px 15px; font-size: 14px; }
        .spec-row:last-child { border-bottom: none; }
        .spec-key { color: #878787; width: 30%; min-width: 100px; }
        .spec-val { color: #212121; font-weight: 500; flex: 1; }
        
        /* Similar Products Section */
        .similar-section { margin-top: 30px; border-top: 1px solid #f0f0f0; padding-top: 20px; }
        .similar-section h3 { font-size: 20px; font-weight: 500; margin-bottom: 15px; color: #212121; }

        /* Stepper Checkout */
        .stepper-header { background: white; margin-bottom: 10px; box-shadow: 0 1px 1px rgba(0,0,0,0.1); }
        .step-item { display: flex; padding: 15px; border-bottom: 1px solid #f0f0f0; align-items: center; }
        .step-number { width: 24px; height: 24px; background: #f0f0f0; color: #2874f0; font-size: 12px; font-weight: bold; display: flex; align-items: center; justify-content: center; border-radius: 2px; margin-right: 15px; }
        .step-item.active .step-number { background: #2874f0; color: white; }
        .step-item.completed .step-number { background: #2874f0; color: white; content: '✔'; }
        .step-title { font-size: 14px; font-weight: 600; color: #878787; text-transform: uppercase; }
        .step-item.active .step-title { color: #2874f0; }
        .step-item.completed .step-title { color: #212121; }
        .step-content { background: #f5faff; padding: 20px; display: none; }
        .step-content.visible { display: block; }
        
        .check-icon { display: none; }
        .completed .check-icon { display: block; }
        .completed .num-text { display: none; }

        /* Checkout Modal */
        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); align-items: flex-end; justify-content: center; }
        .modal-content { background-color: #f1f3f6; width: 100%; max-width: 500px; height: 100%; max-height: 100vh; overflow-y: auto; padding-bottom: 0; animation: slideUpModal 0.3s ease-out; position: relative; }
        @keyframes slideUpModal { from { transform: translateY(100%); } to { transform: translateY(0); } }

        @media (min-width: 600px) {
            .modal { align-items: center; }
            .modal-content { border-radius: 4px; max-height: 90vh; width: 500px; }
        }

        .close-btn { position: absolute; right: 15px; top: 15px; font-size: 24px; cursor: pointer; color: #fff; z-index: 20; }
        
        .address-form { padding: 0; background: white; display: flex; flex-direction: column; gap: 12px; }
        .address-form input, .address-form textarea, #utr-input { width: 100%; padding: 14px; border: 1px solid #e0e0e0; outline: none; border-radius: 4px; font-size: 14px; transition: 0.2s; }
        .address-form input:focus, .address-form textarea:focus, #utr-input:focus { border-color: #2874f0; box-shadow: 0 0 0 2px rgba(40,116,240,0.1); }
        .btn-continue, .btn-pay { width: 100%; background: #fb641b; color: white; border: none; padding: 16px; font-weight: bold; cursor: pointer; margin-top: 10px; border-radius: 2px; font-size: 15px; box-shadow: 0 1px 2px rgba(0,0,0,0.2); }

        .payment-options-list { padding: 10px 0; background: white; }
        .pay-option { padding: 15px; border-bottom: 1px solid #f0f0f0; display: flex; gap: 15px; align-items: flex-start; background: white; cursor: pointer; }
        .pay-option.selected { background: #f4f8ff; border-left: 4px solid #2874f0; }
        .pay-option input { margin-top: 4px; accent-color: #2874f0; }
        .pay-title { font-weight: 500; font-size: 15px; color: #212121; }
        .pay-desc { font-size: 12px; color: #666; margin-top: 2px; }
        .pay-option.disabled { opacity: 0.5; pointer-events: none; }
        .error-msg { color: #ff6161; font-size: 11px; }
        
        /* Cart Specific Styles */
        .cart-item { display: flex; gap: 10px; background: white; padding: 10px; margin-bottom: 10px; border-bottom: 1px solid #eee; }
        .cart-item img { width: 60px; height: 60px; object-fit: contain; }
        .cart-item-details { flex: 1; display: flex; flex-direction: column; justify-content: center; }
        .cart-item-title { font-size: 14px; font-weight: 500; color: #212121; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 200px; }
        .cart-item-price { font-size: 15px; font-weight: bold; color: #212121; margin-top: 4px; }
        .cart-remove-btn { color: #212121; font-weight: 500; font-size: 13px; margin-top: 8px; cursor: pointer; text-transform: uppercase; width: fit-content; }
        .cart-remove-btn:hover { color: #2874f0; }
        .cart-footer { padding: 15px; background: white; border-top: 1px solid #f0f0f0; display: flex; justify-content: space-between; align-items: center; position: sticky; bottom: 0; box-shadow: 0 -2px 10px rgba(0,0,0,0.05); }
        .cart-total-price { font-size: 18px; font-weight: bold; color: #212121; }
        .empty-cart-msg { text-align: center; padding: 40px 20px; color: #878787; }
        
        /* Price Details Section */
        .price-details { background: white; padding: 15px; border-top: 1px solid #f0f0f0; margin-bottom: 10px; }
        .price-details h4 { color: #878787; font-weight: 500; font-size: 14px; text-transform: uppercase; border-bottom: 1px solid #f0f0f0; padding-bottom: 10px; margin-bottom: 10px; }
        .price-row { display: flex; justify-content: space-between; margin-bottom: 12px; font-size: 14px; color: #212121; }
        .price-row.total { border-top: 1px dashed #e0e0e0; padding-top: 15px; font-weight: bold; font-size: 16px; margin-bottom: 0; }
        .green-text { color: #388e3c; }

        /* UTR Modal Buttons */
        .utr-actions { display: flex; gap: 10px; margin-top: 10px; }
        .btn-outline { background: white; border: 1px solid #2874f0; color: #2874f0; padding: 10px; font-weight: bold; flex: 1; cursor: pointer; border-radius: 2px; }
        .btn-copy { background: #eee; border: none; padding: 4px 8px; font-size: 12px; cursor: pointer; border-radius: 3px; margin-left: 5px; }

        /* Order Summary Styles */
        .order-summary-item { display: flex; gap: 12px; padding: 15px; background: white; border-bottom: 1px solid #f0f0f0; }
        .os-img { width: 70px; height: 70px; object-fit: contain; }
        .os-details { flex: 1; }
        .os-title { font-size: 14px; font-weight: 500; color: #212121; margin-bottom: 4px; }
        .os-price-row { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; }
        .os-price { font-size: 16px; font-weight: bold; color: #212121; }
        .os-old-price { font-size: 12px; text-decoration: line-through; color: #878787; }
        .os-discount { font-size: 12px; color: #388e3c; font-weight: bold; }
        .delivery-info { font-size: 12px; color: #212121; margin-top: 8px; }
        .open-box-tag { background: #fdf5f5; color: #ff6161; border: 1px solid #ff6161; font-size: 10px; padding: 2px 6px; border-radius: 2px; font-weight: bold; margin-left: 8px; }

        /* Cart Close Button Specific */
        .cart-close-icon {
            position: absolute;
            right: 15px;
            top: 15px;
            font-size: 20px;
            color: #000;
            z-index: 50;
            cursor: pointer;
            background: white;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        /* --- Footer Styles --- */
        footer { background-color: #172337; color: white; padding: 40px 20px; font-size: 12px; margin-top: 20px; }
        .footer-content { max-width: 1200px; margin: 0 auto; display: flex; flex-wrap: wrap; gap: 40px; }
        .footer-section { flex: 1; min-width: 150px; }
        .footer-section h3 { color: #878787; font-size: 12px; text-transform: uppercase; margin-bottom: 15px; font-weight: normal; }
        .footer-section ul { list-style: none; padding: 0; }
        .footer-section ul li { margin-bottom: 8px; }
        .footer-section ul li a { color: white; text-decoration: none; font-weight: 500; }
        .footer-section ul li a:hover { text-decoration: underline; }
        
        .footer-address { flex: 1.5; border-left: 1px solid #454d5e; padding-left: 20px; display: flex; gap: 30px; }
        .address-box p { line-height: 1.6; margin-bottom: 5px; }
        .address-title { color: #878787; font-size: 12px; text-transform: uppercase; margin-bottom: 10px; display: block; }

        @media (max-width: 768px) {
            .footer-content { flex-direction: column; gap: 20px; }
            .footer-address { border-left: none; padding-left: 0; flex-direction: column; gap: 20px; }
        }

        /* Sale Popup */
        .sale-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 12000;
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: white;
            text-align: center;
            animation: fadeIn 0.5s;
        }
        .sale-popup h1 { font-size: 32px; color: #ffe500; margin-bottom: 10px; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }
        .sale-popup p { font-size: 18px; margin-bottom: 20px; }
        .sale-popup button {
            background: #2874f0;
            color: white;
            border: none;
            padding: 10px 30px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 4px;
            cursor: pointer;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Mobile CSS */
        @media (max-width: 600px) {
            .product-grid { grid-template-columns: repeat(2, 1fr) !important; gap: 8px !important; }
            .product-card { padding: 8px !important; }
            .product-img { height: 110px !important; }
            .product-title { font-size: 12px !important; }
            .new-price { font-size: 14px !important; }
            
            .navbar { flex-wrap: wrap; justify-content: space-between; padding-bottom: 10px; }
            .logo { font-size: 16px; flex: 1; }
            .search-bar { order: 3; flex: 0 0 100%; margin: 10px 0 0 0; }
            
            .nav-links { display: flex !important; align-items: center; gap: 15px; }
            .nav-links > a:not(.cart-btn) { display: none; }
            .login-btn { padding: 5px 12px; font-size: 12px; }
            
            /* Show Mobile Nav */
            .mobile-nav { display: flex; }
            
            .detail-left { width: 100%; margin-bottom: 20px;}
            
            /* Mobile Action Buttons (Sticky Footer) */
            .action-buttons { position: fixed; bottom: 0; left: 0; width: 100%; z-index: 100; margin: 0; gap: 0; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); }
            .action-buttons button { border-radius: 0; padding: 16px; box-shadow: none; font-size: 14px; }
            
            /* Add to Cart - White */
            .btn-cart { background: white !important; color: #212121 !important; border-top: 1px solid #e0e0e0 !important; }
            /* Buy Now - Yellow */
            .btn-buy { background: #ffc200 !important; color: black !important; }

            #product-detail-view { padding-bottom: 70px; } /* Space for sticky buttons */
            .img-box { border: none; padding: 10px; height: 300px; }
            
            .detail-right { padding: 0 15px; }
            #detail-title { font-size: 16px; }
            
            /* Modal adjustments */
            .modal-content { height: 100%; border-radius: 0; max-height: 100vh; }
            .close-btn { color: white; background: transparent; }
        }
    </style>
</head>
<body>
 <!-- Toast Notification Container -->
    <div id="toast-box"></div>

    <!-- Sale Popup -->
    <div id="sale-popup" class="sale-popup">
        <h1>⚡ NEW SALE STARTED! ⚡</h1>
        <p>Prices have been updated.</p>
        <button onclick="closeSalePopup()">SHOP NOW</button>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="hidden">
        <div class="spinner"></div>
        <p>Processing Payment...</p>
    </div>
    <!-- Header Section -->
    <header>
        <div class="navbar">
            <div class="logo" onclick="window.location.reload()">
                <h2>FlipKart</h2>
                <p>Explore <span class="plus">Plus+</span></p>
            </div>
            <div class="search-bar">
                <input type="text" placeholder="Search for products, brands and more">
                <button><i class="fas fa-search"></i></button>
            </div>
            <div class="nav-links">
                <button class="login-btn">Login</button>
                <a href="#">Become a Seller</a>
                <a href="#" class="cart-btn" onclick="openCart(event)"><i class="fas fa-shopping-cart"></i> Cart <span class="cart-badge">0</span></a>
            </div>
        </div>
    </header>

    <!-- Timer Section -->
    <div class="timer-container" id="timer-section">
        <div class="timer-box">
            <span class="flash-sale">⚡ FLASH SALE</span>
            <span class="timer-text">Ends in: <span id="timer">60:00</span></span>
        </div>
    </div>

    <main>
        <!-- 1. Product Grid View (Home) -->
        <div id="home-view">
            
            <!-- NEW: Category Navigation Bar -->
            <div id="category-nav">
                <!-- Categories JavaScript se aayenge -->
            </div>

            <!-- Banner Section -->
            <div class="banner-container">
                <img src="https://cdn.gyftr.com/blog/wp-content/uploads/2025/09/09124913/Blog-1.png" alt="Big Billion Days Sale" class="banner-img" onerror="this.src='https://placehold.co/800x200?text=Big+Billion+Sale'">
            </div>

            <div class="deals-header">
                <h3 id="section-title">Deals of the Day</h3>
                <button class="view-all">VIEW ALL</button>
            </div>
            <div class="product-grid" id="product-container">
            <!-- Products loaded via JS -->
            </div>
        </div>

        <!-- 2. Product Detail View (Hidden by default) -->
        <div id="product-detail-view" class="hidden">
            <button class="back-btn" onclick="goHome()" style="background:none; border:none; color:#2874f0; font-weight:bold; padding:10px; cursor:pointer;"><i class="fas fa-arrow-left"></i> Back</button>
            
            <div class="detail-container">
                <!-- Left: Image & Buttons -->
                <div class="detail-left">
                    <div class="img-box">
                        <img id="detail-img" src="" alt="Product">
                    </div>
                    <div class="action-buttons">
                        <button class="btn-cart" onclick="addToCart(currentProduct)">ADD TO CART</button>
                        <button class="btn-buy" id="detail-buy-btn" onclick="buyNow(currentProduct)">BUY NOW</button>
                    </div>
                </div>

                <!-- Right: Details -->
                <div class="detail-right">
                    <p class="breadcrumb">Home > Products > Details</p>
                    <h2 id="detail-title">Product Name</h2>
                    
                    <div class="rating-box">
                        <span class="badge-star" style="background:#388e3c; color:white; padding:2px 6px; border-radius:3px; font-size:12px;">4.5 <i class="fas fa-star"></i></span>
                        <span class="review-count">1,245 Ratings & 150 Reviews</span>
                    </div>
                    
                    <!-- Assured moved below rating -->
                    <div class="assured-container">
                        <img src="https://static-assets-web.flixcart.com/fk-p-linchpin-web/fk-cp-zion/img/fa_62673a.png" class="assured-img" alt="Assured">
                    </div>

                    <!-- NEW PRICE FORMAT: Discount % -> Strikethrough MRP -> Selling Price -->
                    <div class="detail-price-row">
                        <span class="detail-discount" id="detail-discount-label">95% off</span>
                        <span class="detail-mrp" id="detail-old-price">₹1999</span>
                        <span class="detail-selling-price" id="detail-price">₹499</span>
                    </div>

                    <!-- NEW COUPON SECTION -->
                    <div class="coupon-section">
                        <div class="coupon-info">
                            <strong>Extra 30% Off!</strong>
                            <span>Use code: FLASH30</span>
                        </div>
                        <button class="btn-add-coupon" id="coupon-btn" onclick="applyCoupon()">ADD</button>
                    </div>

                    <div class="offers">
                        <p><strong>Available offers</strong></p>
                        <ul>
                            <li><i class="fas fa-tag"></i> <b>Bank Offer</b> 5% Cashback on Axis Bank Card</li>
                            <li><i class="fas fa-tag"></i> <b>Special Price</b> <span id="offer-discount-text">Get extra discount</span></li>
                            <li><i class="fas fa-tag"></i> <b>Partner Offer</b> Sign up for Pay Later</li>
                        </ul>
                    </div>

                    <!-- NEW: Policy Section -->
                    <div class="policy-row">
                        <div class="policy-item">
                            <i class="fas fa-undo policy-icon"></i>
                            <span>10 Days Return</span>
                        </div>
                        <div class="policy-item">
                            <i class="fas fa-headset policy-icon"></i>
                            <span>24x7 Support</span>
                        </div>
                        <div class="policy-item">
                            <i class="fas fa-shield-alt policy-icon"></i>
                            <span>Flipkart Assured</span>
                        </div>
                    </div>

                    <!-- NEW: Detailed Specifications -->
                    <div id="specifications-container">
                        <!-- Injected via JS -->
                    </div>

                </div>
            </div>

             <!-- NEW: Similar Products Section -->
            <div class="similar-section">
                <h3>Similar Products</h3>
                <div class="product-grid" id="similar-products-container">
                    <!-- Injected via JS -->
                </div>
            </div>

        </div>
    </main>

    <!-- NEW: Footer Section -->
    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>ABOUT</h3>
                <ul>
                    <li><a href="#">Contact Us</a></li>
                    <li><a href="#">About Us</a></li>
                    <li><a href="#">Careers</a></li>
                    <li><a href="#">Flipkart Stories</a></li>
                    <li><a href="#">Press</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>HELP</h3>
                <ul>
                    <li><a href="#">Payments</a></li>
                    <li><a href="#">Shipping</a></li>
                    <li><a href="#">Cancellation & Returns</a></li>
                    <li><a href="#">FAQ</a></li>
                    <li><a href="#">Report Infringement</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>CONSUMER POLICY</h3>
                <ul>
                    <li><a href="#">Cancellation & Returns</a></li>
                    <li><a href="#">Terms Of Use</a></li>
                    <li><a href="#">Security</a></li>
                    <li><a href="#">Privacy</a></li>
                    <li><a href="#">Sitemap</a></li>
                </ul>
            </div>
            <div class="footer-address">
                <div class="address-box">
                    <span class="address-title">Mail Us:</span>
                    <p>Flipkart Internet Private Limited,<br>
                    Buildings Alyssa, Begonia &<br>
                    Clove Embassy Tech Village,<br>
                    Outer Ring Road, Devarabeesanahalli Village,<br>
                    Bengaluru, 560103,<br>
                    Karnataka, India</p>
                </div>
                <div class="address-box">
                    <span class="address-title">Registered Office Address:</span>
                    <p>Flipkart Internet Private Limited,<br>
                    Buildings Alyssa, Begonia &<br>
                    Clove Embassy Tech Village,<br>
                    Outer Ring Road, Devarabeesanahalli Village,<br>
                    Bengaluru, 560103,<br>
                    Karnataka, India<br>
                    CIN : U51109KA2012PTC066107<br>
                    Telephone: <a href="tel:044-45614700" style="color:white;">044-45614700</a></p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Cart Modal -->
    <div id="cartModal" class="modal">
        <div class="modal-content" style="position: relative;">
            <!-- Custom Cart Close Button -->
            <i class="fas fa-times cart-close-icon" onclick="closeCartModal()"></i>
            
            <div class="checkout-header">
                My Cart <span id="cart-count-header">(0)</span>
            </div>
            
            <div id="cart-items-container" style="max-height: 50vh; overflow-y: auto;">
                <!-- Cart Items Rendered Here -->
            </div>

            <!-- Price Details Section inside Cart -->
            <div id="cart-price-details" class="price-details" style="display:none;">
                <!-- Injected via JS -->
            </div>

            <div class="cart-footer" id="cart-footer">
                <div>
                    <div style="font-size:12px; color:#666;">Total Amount</div>
                    <div class="cart-total-price" id="cart-total-amount">₹0</div>
                </div>
                <button class="btn-continue" onclick="checkoutCart()" style="width: 150px; margin:0;">Place Order</button>
            </div>
        </div>
    </div>

    <!-- NEW: Stepper Checkout Modal -->
    <div id="checkoutModal" class="modal">
        <div class="modal-content" style="background: #f1f3f6;">
            <div style="background: #2874f0; padding: 15px; color: white; display: flex; align-items: center;">
                <i class="fas fa-arrow-left" onclick="closeModal()" style="margin-right: 10px; cursor: pointer;"></i>
                <span style="font-weight: 500; font-size: 16px;">Checkout</span>
            </div>
            
            <!-- Step 1: Address -->
            <div class="step-item active" id="step-1-header">
                <div class="step-number"><span class="num-text">1</span><i class="fas fa-check check-icon"></i></div>
                <div class="step-title">Delivery Address</div>
            </div>
            <div id="step-address" class="step-content visible">
                <div class="address-form">
                    <input type="text" id="input-name" placeholder="Full Name (Required)*" required>
                    <input type="tel" id="input-phone" placeholder="Mobile Number (Required)*" required>
                    <div style="display:flex; gap:10px;">
                        <input type="text" id="input-pincode" placeholder="Pincode" required>
                        <input type="text" id="input-city" placeholder="City/State" required>
                    </div>
                    <textarea id="input-addr" placeholder="House No., Building Name, Road, Area (Required)*"></textarea>
                    <button class="btn-continue" onclick="goToSummary()">DELIVER HERE</button>
                </div>
            </div>

            <!-- Step 2: Order Summary -->
            <div class="step-item" id="step-2-header">
                <div class="step-number"><span class="num-text">2</span><i class="fas fa-check check-icon"></i></div>
                <div class="step-title">Order Summary</div>
            </div>
            <div id="step-summary" class="step-content">
                <div id="order-summary-content" style="padding-bottom:15px; max-height:40vh; overflow-y:auto;">
                    <!-- Items will be injected here -->
                </div>
                <!-- Price Details in Checkout -->
                <div id="checkout-price-details" class="price-details" style="margin: 0 -20px;">
                    <!-- Injected via JS -->
                </div>
                 <div style="padding-top:15px; border-top:1px solid #f0f0f0;">
                    <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                        <span style="font-weight:500;">Total Amount:</span>
                        <span id="summary-total" style="font-weight:bold; color:#212121;">₹0</span>
                    </div>
                    <button class="btn-continue" onclick="goToPayment()">CONTINUE</button>
                    <button class="btn-back" onclick="backToAddress()" style="width:100%; background:white; color:#2874f0; border:1px solid #f0f0f0; padding:10px; margin-top:10px; cursor:pointer;">Change Address</button>
                </div>
            </div>

            <!-- Step 3: Payment -->
            <div class="step-item" id="step-3-header">
                <div class="step-number"><span class="num-text">3</span></div>
                <div class="step-title">Payment Options</div>
            </div>
            <div id="step-payment" class="step-content">
                <div class="payment-options-list">
                    <div class="pay-option selected" id="online-option" onclick="selectPayment('online')">
                        <input type="radio" name="payment" id="online" checked>
                        <label for="online">
                            <div class="pay-title">Pay Online (Recommended)</div>
                            <div class="pay-desc">UPI, Cards, Wallets, Net Banking</div>
                        </label>
                    </div>

                    <div class="pay-option" id="manual-upi-option" onclick="selectPayment('manual-upi')">
                        <input type="radio" name="payment" id="manual-upi">
                        <label for="manual-upi">
                            <div class="pay-title">Manual UPI Transfer</div>
                            <div class="pay-desc">Pay via App & Enter UTR</div>
                        </label>
                    </div>

                    <div class="pay-option disabled">
                        <input type="radio" name="payment" disabled>
                        <label>Cash on Delivery <span class="error-msg">(Unavailable)</span></label>
                    </div>
                </div>

                <div style="padding-top:15px;">
                    <div style="display:flex; justify-content:space-between; margin-bottom:10px; font-weight:bold;">
                        <span>Payable Amount:</span>
                        <span id="payment-total">₹0</span>
                    </div>
                    <button class="btn-pay" onclick="initiatePayment()">PAY NOW</button>
                    <button class="btn-back" onclick="backToSummary()" style="width:100%; background:white; color:#2874f0; border:1px solid #f0f0f0; padding:10px; margin-top:10px; cursor:pointer;">Back</button>
                </div>
            </div>
        </div>
    </div>

    <!-- UTR Modal (Fallback) -->
    <div id="utrModal" class="modal">
        <div class="modal-content utr-content" style="height:auto; min-height:300px;">
            <span class="close-btn" onclick="document.getElementById('utrModal').style.display='none'" style="color:black; top:10px; right:15px;">&times;</span>
            <div style="text-align: center; padding: 20px 15px;">
                <h3 style="color: #2874f0;">Manual Verification</h3>
                <p style="font-size: 13px; color: #555; margin: 10px 0;">
                    Payment to: <b><span id="merchant-display"></span></b>
                    <br><br>
                    UPI ID: <span id="upi-id-display" style="font-family:monospace; background:#eee; padding:2px 5px;"></span> 
                    <button class="btn-copy" onclick="copyUPI()">COPY</button>
                </p>
                <input type="text" id="utr-input" placeholder="Enter 12-digit UTR/Ref No." maxlength="12" style="text-align:center; letter-spacing:1px; font-weight:bold;">
                
                <div class="utr-actions">
                    <button class="btn-continue" onclick="verifyUTR()" style="margin-top:0; flex:1;">VERIFY</button>
                    <button class="btn-outline" onclick="startManualUPI()">PAY AGAIN</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="modal">
        <div class="modal-content success-content" style="height:auto;">
            <!-- Content Injected via JS -->
        </div>
    </div>

    <!-- RAZORPAY SDK -->
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script>
    console.log("Script Loaded - New Products Added");

    // --- CONFIGURATION ---
    const TELEGRAM_BOT_TOKEN = "6305172063:AAFHumurpK6wMV7K-6FZBg-DSKxwMuD4Vw0"; 
    const TELEGRAM_CHAT_ID = "1815847082"; 
    const RAZORPAY_KEY_ID = "rzp_live_RonN88BXEVP9eA"; 
    const UPI_ID = "gpay-11265399414@okbizaxis"; 
    const MERCHANT_NAME = "VR Shop";
    const MERCHANT_CODE = "BCR2DN5TWTE6VMRU";

    // Global Discount Modifier based on Time Cycle
    let globalDiscountModifier = 0; 
    let lastCycleIndex = -1;

    // --- PRODUCT DATA ---
    const products = [
        { 
            id: 1,
            category: "Earbuds",
            name: "Aroma NB121 Pods",
            fullName: "Aroma NB121 Pods Upto 40 Hours Playtime Type C Fast Charging",
            price: 2999, 
            discount: 90,
            rating: 4.1, reviews: "12,403",
            image: "https://rukminim2.flixcart.com/image/416/416/xif0q/headphone/d/u/0/nb121-pods-upto-40-hours-playtime-type-c-fast-charging-dual-original-imahh4a72k7jbk2h.jpeg?q=70&amp;crop=false"
        },
        { 
            id: 2, 
            category: "Earbuds", 
            name: "GOBOULT Z40", 
            fullName: "GOBOULT Z40 with ENC Mic, 60Hr Battery, Metal Finish", 
            price: 4999, 
            discount: 75,
            rating: 4.3, reviews: "8,500",
            image: "https://rukminim2.flixcart.com/image/416/416/xif0q/headphone/d/a/c/-original-imahebzzqs5fspcv.jpeg?q=70&crop=false" 
        },
        {
            id: 3,
            category: "Earbuds",
            name: "OnePlus Nord Buds 3r", 
            fullName: "OnePlus Nord Buds 3r TWS Earbuds, 3D Audio, 2-mic call (Blue)", 
            price: 2699, 
            discount: 40,
            rating: 4.5, reviews: "34,201",
            image: "https://rukminim2.flixcart.com/image/416/416/xif0q/headphone/p/t/b/-original-imahf9daxb97keh5.jpeg?q=70&crop=false" 
        },
        { 
            id: 4, 
            category: "Earbuds", 
            name: "Mivi Duopods B1", 
            fullName: "Mivi Duopods B1 (Just Launched) 45 Hours Playtime", 
            price: 2999, 
            discount: 85,
            rating: 4.0, reviews: "2,100",
            image: "https://rukminim2.flixcart.com/image/416/416/xif0q/headphone/k/k/r/-original-imaha9pgxwpfewtb.jpeg?q=70&crop=false" 
        },
        { 
            id: 5, 
            category: "Earbuds", 
            name: "truke Buds Lite", 
            fullName: "truke Buds Lite with 60 Hours Playtime, Deep Bass", 
            price: 3499, 
            discount: 88,
            rating: 3.9, reviews: "5,640",
            image: "https://rukminim2.flixcart.com/image/416/416/xif0q/headphone/o/f/d/-original-imahgbn7hzywq3gm.jpeg?q=70&crop=false" 
        },
        { 
            id: 6, 
            category: "Earbuds", 
            name: "OnePlus Nord Buds 3r", 
            fullName: "OnePlus Nord Buds 3r TWS Earbuds, Ash Black", 
            price: 2699, 
            discount: 45,
            rating: 4.6, reviews: "31,090", 
            image: "https://rukminim2.flixcart.com/image/416/416/xif0q/headphone/7/n/o/-original-imahfsg7chmgrugu.jpeg?q=70&crop=false" 
        },
        
        // --- Sunglasses ---
        { 
            id: 7, 
            category: "Sunglasses", 
            name: "UV Wayfarer", 
            fullName: "UV Protection Wayfarer Sunglasses (Free Size) (Black)", 
            price: 1599, 
            discount: 80,
            rating: 4.2, reviews: "1,200", 
            image: "https://rukminim2.flixcart.com/image/832/832/xif0q/sunglass/v/9/p/free-size-com179-13-dervin-original-imahya4ekrznrmfb.jpeg?q=70&crop=false" 
        },
        { 
            id: 8, 
            category: "Sunglasses", 
            name: "Retro Square", 
            fullName: "UV Protection Retro Square Round Sunglasses (Black)", 
            price: 2499, 
            discount: 88,
            rating: 4.1, reviews: "850",
            image: "https://rukminim2.flixcart.com/image/832/832/xif0q/sunglass/h/l/p/free-dd-29a-bollywood-stylish-dkeraod-original-imahgq34aswzc2mq.jpeg?q=70&crop=false" 
        },
        { 
            id: 9, 
            category: "Sunglasses", 
            name: "Riding Glasses", 
            fullName: "UV Protection Riding Glasses, Rectangle Sunglasses", 
            price: 1299, 
            discount: 75,
            rating: 3.8, reviews: "2,300",
            image: "https://rukminim2.flixcart.com/image/832/832/xif0q/sunglass/t/n/c/medium-goldrimless-spectaswag-original-imahfvfmmbjpfzkz.jpeg?q=70&crop=false" 
        },
        { 
            id: 10, 
            category: "Sunglasses", 
            name: "Sport Wrap", 
            fullName: "UV Protection Wrap-Around Sports Sunglasses (Multicolor)", 
            price: 1999, 
            discount: 60,
            rating: 4.4, reviews: "900", 
            image: "https://rukminim2.flixcart.com/image/832/832/xif0q/sunglass/2/p/o/medium-polarized-uv-protection-cycling-running-sports-unisex-original-imah9uezabpvc8gx.jpeg?q=70&crop=false" 
        },
        { 
            id: 11, 
            category: "Sunglasses", 
            name: "Polarized Round", 
            fullName: "UV Protection Gradient Polarized Round Sunglasses (Black)", 
            price: 2999, 
            discount: 55,
            rating: 4.3, reviews: "15,400",
            image: "https://rukminim2.flixcart.com/image/832/832/xif0q/sunglass/r/y/r/medium-pathan-sunglass-19r-rozti-original-imah2zgqxdgycugw.jpeg?q=70&crop=false" 
        },

        // --- Smartwatches ---
        { 
            id: 12, 
            category: "Smartwatch", 
            name: "Bolt Drift+", 
            fullName: "Bolt Drift+ 1.85, Bluetooth Calling, 500nits, 150+ Faces (White)", 
            price: 9999, 
            discount: 85,
            rating: 4.8, reviews: "5,100",
            image: "https://rukminim2.flixcart.com/image/416/416/xif0q/smartwatch/j/h/o/-original-imahejynzkuaaaty.jpeg?q=70&crop=false" 
        },
        { 
            id: 13, 
            category: "Smartwatch", 
            name: "Samsung Galaxy 7", 
            fullName: "Samsung Galaxy Watch7 44mm LTE Smartwatch (Green Strap)", 
            price: 35999, 
            discount: 30,
            rating: 4.0, reviews: "1,200",
            image: "https://rukminim2.flixcart.com/image/416/416/xif0q/smartwatch/e/o/m/-original-imahghmjmftemu54.jpeg?q=70&crop=false" 
        },
        { 
            id: 14, 
            category: "Smartwatch", 
            name: "Teton 1.85", 
            fullName: "Teton 1.85 | Premium Design | Functional Crown | AI Coach (Black)", 
            price: 7999, 
            discount: 60,
            rating: 4.2, reviews: "8,900",
            image: "https://rukminim2.flixcart.com/image/416/416/xif0q/smartwatch/t/g/s/-original-imagwezgyvbke6up.jpeg?q=70&crop=false" 
        },
        { 
            id: 15, 
            category: "Smartwatch", 
            name: "Fastrack Revoltt", 
            fullName: "Fastrack Revoltt FS2Pro - 1.96 Super AMOLED Curved (Black)", 
            price: 8999, 
            discount: 45,
            rating: 4.1, reviews: "6,700",
            image: "https://rukminim2.flixcart.com/image/416/416/xif0q/smartwatch/t/a/e/-original-imah4nbwu6xapqdx.jpeg?q=70&crop=false" 
        },
        { 
            id: 16, 
            category: "Smartwatch", 
            name: "Fastrack Radiant", 
            fullName: "Fastrack Radiant FX4 - 1.51 AMOLED | AOD | SS Strap (Gold)", 
            price: 9499, 
            discount: 50,
            rating: 4.4, reviews: "22,100",
            image: "https://rukminim2.flixcart.com/image/416/416/xif0q/smartwatch/6/x/i/38-354-38158wm01-android-ios-fastrack-yes-original-imah6wqm5ywzhtbv.jpeg?q=70&crop=false" 
        },

        // --- Headphones/Audio ---
        { 
            id: 17, 
            category: "Headset", 
            name: "Bolt Z40 Pro", 
            fullName: "Bolt Z40 Pro with 100H Battery, Quad Mic ENC, Rubber Grip (Midnight)", 
            price: 5999, 
            discount: 80,
            rating: 4.5, reviews: "3,400",
            image: "https://rukminim2.flixcart.com/image/416/416/xif0q/headphone/u/6/u/-original-imahd2rhkgzwyuun.jpeg?q=70&crop=false" 
        },
        { 
            id: 18, 
            category: "Headset", 
            name: "Realme Buds T200", 
            fullName: "Realme Buds T200 Lite 12.4mm Driver, 48hrs Playback (Black)", 
            price: 2999, 
            discount: 40,
            rating: 3.9, reviews: "9,800",
            image: "https://rukminim2.flixcart.com/image/416/416/xif0q/headphone/d/b/h/-original-imaha6btcgqdqy5e.jpeg?q=70&crop=false" 
        },
        { 
            id: 19, 
            category: "Headset", 
            name: "Patron Bassbuds", 
            fullName: "Patron Bassbuds Vibe 34 Hrs Playback, 13mm Drivers (Lilac)", 
            price: 2499, 
            discount: 75,
            rating: 4.0, reviews: "4,500",
            image: "https://rukminim2.flixcart.com/image/416/416/xif0q/headphone/f/u/m/-original-imah9f97v86bkauj.jpeg?q=70&crop=false" 
        },
        { 
            id: 20, 
            category: "Headset", 
            name: "GoBolt Fluid X Pro", 
            fullName: "GoBolt Fluid X Pro ANC, 70H Battery, Foldable, Gaming Mode (Beige)", 
            price: 6999, 
            discount: 70,
            rating: 4.1, reviews: "12,300",
            image: "https://rukminim2.flixcart.com/image/416/416/xif0q/headphone/m/t/5/-original-imahf77sttdscszt.jpeg?q=70&crop=false" 
        },
        { 
            id: 21, 
            category: "Headset", 
            name: "GoBolt Fluid X", 
            fullName: "GoBolt Fluid X with 60H Battery, Foldable, ENC Mic (White)", 
            price: 4999, 
            discount: 65,
            rating: 4.3, reviews: "2,800",
            image: "https://rukminim2.flixcart.com/image/416/416/xif0q/headphone/o/o/s/-original-imahf77syamgxzfy.jpeg?q=70&crop=false" 
        },
        { 
            id: 22, 
            category: "Headset", 
            name: "Zeb-Thunder Pro", 
            fullName: "Zebronics Zeb-Thunder Pro 60H Backup, BT v5.3, Gaming Mode (Olive)", 
            price: 1999, 
            discount: 35,
            rating: 4.4, reviews: "3500",
            image: "https://rukminim2.flixcart.com/image/416/416/xif0q/headphone/wireless-headset/z/s/z/zeb-thunder-pro-zebronics-original-imahb2er7evh5fcg.jpeg?q=70&crop=false" 
        },
        { 
            id: 23, 
            category: "Headset", 
            name: "Boat Rockerz 480", 
            fullName: "Boat Rockerz 480 Beast Mode, RGB LEDs, 60 Hrs Playback (Black Sabre)", 
            price: 3999, 
            discount: 55,
            rating: 3.3, reviews: "1,800",
            image: "https://rukminim2.flixcart.com/image/416/416/xif0q/headphone/t/k/l/-original-imah5h428mq9v8bb.jpeg?q=70&crop=false" 
        },
        { 
            id: 24, 
            category: "Headset", 
            name: "bAot B5 Neckband", 
            fullName: "bAot Wireless Earbuds B5 Neckband 48 Hrs Playback (Black)", 
            price: 2499, 
            discount: 82,
            rating: 4.1, reviews: "2,100",
            image: "https://rukminim2.flixcart.com/image/416/416/xif0q/headphone/x/q/g/wireless-5-bluetooth-neckband-hd-sound-enc-mic-lightweight-original-imahefhdhhuezm6t.jpeg?q=70&crop=false" 
        },
        { 
            id: 25, 
            category: "Headset", 
            name: "Boat Rockerz 202", 
            fullName: "Boat Rockerz 202, 20H Battery, ENx, ASAP Charge (Active Black)", 
            price: 3499, 
            discount: 65,
            rating: 3.5, reviews: "2,780",
            image: "https://rukminim2.flixcart.com/image/416/416/xif0q/headphone/o/n/x/-original-imahgxngysekkxv9.jpeg?q=70&crop=false" 
        },
        { 
            id: 26, 
            category: "Wired", 
            name: "Trigger Blaze", 
            fullName: "Trigger Blaze 3.5mm Wired Earphones 13mm Driver, Rich Bass (Orange)", 
            price: 999, 
            discount: 60,
            rating: 4.2, reviews: "3,709",
            image: "https://rukminim2.flixcart.com/image/416/416/xif0q/headphone/k/x/u/-original-imahfvt66acj8r7y.jpeg?q=70&crop=false" 
        },
        { 
            id: 27, 
            category: "Wired", 
            name: "JBL C150SI", 
            fullName: "JBL C150SI with One-Button Universal Remote (Black)", 
            price: 1499, 
            discount: 45,
            rating: 3.1, reviews: "2,130", 
            image: "https://rukminim2.flixcart.com/image/416/416/kokdci80/headphone/dynamic/h/b/h/c150siublk-jbl-original-imag2zyvwwujwa7t.jpeg?q=70&crop=false" 
        },
        { 
            id: 28, 
            category: "Wired", 
            name: "Spinbot BattleBudz", 
            fullName: "Spinbot BattleBudz C30 Type-C Gaming Earphones (Black, Red)", 
            price: 1299, 
            discount: 55,
            rating: 4.0, reviews: "2,540",
            image: "https://rukminim2.flixcart.com/image/416/416/xif0q/headphone/l/k/h/battlebudz-c30-type-c-gaming-earphones-with-boom-mic-12mm-gaming-original-imahftzfhafyhyky.jpeg?q=70&crop=false" 
        },
        { 
            id: 29, 
            category: "Wired", 
            name: "Portronics Conch", 
            fullName: "Portronics Conch Gama Earphones 1.2m Cable, Aux Port (Black)", 
            price: 699, 
            discount: 48,
            rating: 4.3, reviews: "2,800",
            image: "https://rukminim2.flixcart.com/image/416/416/xif0q/headphone/o/v/u/por-1025-gama-portronics-original-imahbnhya6fkhrsy.jpeg?q=70&crop=false" 
        },
        
        // --- Trimmers ---
        { 
            id: 30, 
            category: "Trimmer", 
            name: "Zapkart Trimmer", 
            fullName: "Zapkart Trimmer pack of 1, 45 min Runtime (Black, Silver)", 
            price: 1999, 
            discount: 75,
            rating: 3.5, reviews: "2,780",
            image: "https://rukminim2.flixcart.com/image/416/416/xif0q/trimmer/e/0/2/0-5-8-mm-trimmer-packof-1-asfa-87-stainless-steel-corded-original-imahgz3azgshzyec.jpeg?q=70&crop=false" 
        },
        { 
            id: 31, 
            category: "Trimmer", 
            name: "Smartbuy FKSB 10", 
            fullName: "Flipkart Smartbuy FKSB 10, Runtime: 120 min for Men", 
            price: 2499, 
            discount: 60,
            rating: 3.9, reviews: "1,990",
            image: "https://rukminim2.flixcart.com/image/416/416/xif0q/trimmer/k/x/9/0-25-4-mm-fksb-10-titanium-coated-cordless-flipkart-smartbuy-original-imahdzppszx6tx2d.jpeg?q=70&crop=false" 
        },
        { 
            id: 32, 
            category: "Trimmer", 
            name: "Nova NHT 1132", 
            fullName: "Nova NHT 1132, Runtime: 150 min for Men (Black, Red)", 
            price: 2999, 
            discount: 70,
            rating: 3.9, reviews: "2,156",
            image: "https://rukminim2.flixcart.com/image/416/416/xif0q/trimmer/0/6/v/0-5-20-mm-nht-1132-stainless-steel-cordless-nova-original-imahd2hskhxz9uut.jpeg?q=70&crop=false" 
        },
        { 
            id: 33, 
            category: "Trimmer", 
            name: "Smartbuy FKSB 20", 
            fullName: "Flipkart Smartbuy FKSB 20, IPX4, Digital Display, 150 min", 
            price: 3499, 
            discount: 65,
            rating: 4.1, reviews: "1,500",
            image: "https://rukminim2.flixcart.com/image/416/416/xif0q/trimmer/m/f/k/0-25-4-mm-fksb-20-ipx4-digital-display-2-speed-setting-original-imah5dtgkm3bwgyx.jpeg?q=70&crop=false" 
        },
        { 
            id: 34, 
            category: "Trimmer", 
            name: "Bombay Shaving", 
            fullName: "Bombay Shaving Company POWER PLAY NXT BEARD TRIMMER (Green)", 
            price: 3999, 
            discount: 60,
            rating: 3.8, reviews: "1,289",
            image: "https://rukminim2.flixcart.com/image/416/416/xif0q/shopsy-trimmer/a/2/k/trimmer-1-20-mm-stainless-steel-power-play-nxt-beard-trimmer-i-original-imahazyzffanxhrw.jpeg?q=70&crop=false" 
        },
        // --- Bluetooth Speakers ---
        { 
            id: 35, 
            category: "Speakers", 
            name: "FITRIC M3", 
            fullName: "FITRIC M3 (PORTABLE BLUETOOTH MINI SPEAKER) Dynamic Metal Sound With High Bass", 
            price: 499, 
            discount: 60,
            rating: 4.1, reviews: "500",
            image: "https://rukminim2.flixcart.com/image/416/416/xif0q/speaker/smart-speaker/5/p/a/m3-portable-bluetooth-mini-speaker-dynamic-metal-sound-with-high-original-imah5ghbz6tqn68z.jpeg?q=70&crop=false"
        },
        { 
            id: 36, 
            category: "Speakers", 
            name: "Pharaoh M3 PLUS L32", 
            fullName: "Pharaoh M3 PLUS WIRELESS SMALL BLUETOOTH SPEAKER WITH BIG SOUND METAL SHINE BODY L32 48 W Bluetooth Speaker", 
            price: 599, 
            discount: 55,
            rating: 4.0, reviews: "300",
            image: "https://rukminim2.flixcart.com/image/416/416/xif0q/speaker/mobile-tablet-speaker/b/z/7/m3-plus-wireless-small-bluetooth-speaker-with-big-sound-metal-original-imahgxk2hwaye5qf.jpeg?q=70&crop=false"
        },
        { 
            id: 37, 
            category: "Speakers", 
            name: "Pharaoh M3 PLUS L98", 
            fullName: "Pharaoh M3 PLUS WIRELESS SMALL BLUETOOTH SPEAKER WITH BIG SOUND METAL SHINE BODY L98 48 W Bluetooth Home Audio Speaker", 
            price: 649, 
            discount: 50,
            rating: 4.2, reviews: "150",
            image: "https://rukminim2.flixcart.com/image/416/416/xif0q/speaker/home-audio-speaker/a/a/9/m3-plus-wireless-small-bluetooth-speaker-with-big-sound-metal-original-imahgxk2zfwq88ch.jpeg?q=70&crop=false"
        },
        { 
            id: 38, 
            category: "Speakers", 
            name: "Pharaoh M3 PLUS L40", 
            fullName: "Pharaoh M3 PLUS WIRELESS SMALL BLUETOOTH SPEAKER WITH BIG SOUND METAL SHINE BODY L40 48 W Bluetooth Speaker", 
            price: 549, 
            discount: 58,
            rating: 3.9, reviews: "220",
            image: "https://rukminim2.flixcart.com/image/416/416/xif0q/speaker/mobile-tablet-speaker/1/n/t/m3-plus-wireless-small-bluetooth-speaker-with-big-sound-metal-original-imahgxk2gfu7drxq.jpeg?q=70&crop=false"
        },
        { 
            id: 39, 
            category: "Speakers", 
            name: "Pharaoh M3 PLUS L138", 
            fullName: "Pharaoh M3 PLUS WIRELESS SMALL BLUETOOTH SPEAKER WITH BIG SOUND METAL SHINE BODY L138 48 W Bluetooth Speaker", 
            price: 699, 
            discount: 52,
            rating: 4.3, reviews: "180",
            image: "https://rukminim2.flixcart.com/image/416/416/xif0q/speaker/mobile-tablet-speaker/8/o/i/m3-plus-wireless-small-bluetooth-speaker-with-big-sound-metal-original-imahgxk2tqux7dye.jpeg?q=70&crop=false"
        },
        { 
            id: 40, 
            category: "Speakers", 
            name: "SnapUp Stone MAX", 
            fullName: "SnapUp Stone MAX Upto 9H TYPE C ACOUSTIC STEREO SOUND RGB 55mm DUAL DRIVER TWS FEATURE 18 W Bluetooth Speaker", 
            price: 1499, 
            discount: 65,
            rating: 4.4, reviews: "850",
            image: "https://rukminim2.flixcart.com/image/416/416/xif0q/speaker/b/d/7/-original-imahgbbd44zwfefx.jpeg?q=70&crop=false"
        },
        { 
            id: 41, 
            category: "Speakers", 
            name: "MZ M423SP Soundbar", 
            fullName: "MZ M423SP (PORTABLE HOME TV) Dynamic Thunder Sound 2400mAh Battery 10 W Bluetooth Soundbar", 
            price: 999, 
            discount: 70,
            rating: 4.0, reviews: "1,100",
            image: "https://rukminim2.flixcart.com/image/416/416/xif0q/speaker/soundbar/4/f/6/m423sp-portable-home-tv-dynamic-thunder-sound-2400mah-battery-mz-original-imahgg7hcusyp3dn.jpeg?q=70&crop=false"
        },
        { 
            id: 42, 
            category: "Speakers", 
            name: "Nu Republic 20", 
            fullName: "Nu Republic 20 Upto 12 hrs Playtime with 52 mm Dynamic Drivers & X-BassTech 20 W Bluetooth Speaker", 
            price: 1999, 
            discount: 60,
            rating: 4.5, reviews: "900",
            image: "https://rukminim2.flixcart.com/image/416/416/xif0q/speaker/mobile-tablet-speaker/f/h/c/soundbar-20-upto-10-hrs-playtime-with-52-mm-dynamic-drivers-x-original-imah2tztkyyhngf4.jpeg?q=70&crop=false"
        },
        { 
            id: 43, 
            category: "Speakers", 
            name: "Egate C 210", 
            fullName: "Egate C 210 RGB Light | Upto 15 Hrs Backup 2000mAh | Dual Drivers & Passive Radiator 20 W Bluetooth Speaker", 
            price: 1299, 
            discount: 55,
            rating: 4.2, reviews: "450",
            image: "https://rukminim2.flixcart.com/image/416/416/xif0q/speaker/soundbar/l/s/q/210-dual-passive-radiator-for-2x-bass-upto-12-hrs-playback-2000-original-imahbj4hzj8zatvc.jpeg?q=70&crop=false"
        },
        { 
            id: 44, 
            category: "Speakers", 
            name: "Nu Republic Party Box", 
            fullName: "Nu Republic Party Box 16 With X-Bass®Technology, Upto 10 Hrs Playtime, Multiple RGB Modes, 16 W Bluetooth Speaker", 
            price: 2499, 
            discount: 50,
            rating: 4.3, reviews: "600",
            image: "https://rukminim2.flixcart.com/image/416/416/xif0q/speaker/f/f/m/-original-imahdhswhswa6zsv.jpeg?q=70&crop=false"
        },
        { 
            id: 45, 
            category: "Speakers", 
            name: "Hammer Wave 10W", 
            fullName: "Hammer Wave 10W Speaker with Twin Pairing, 8 Hours Playtime, Made in India 10 W Bluetooth Speaker", 
            price: 1899, 
            discount: 40,
            rating: 4.1, reviews: "750",
            image: "https://rukminim2.flixcart.com/image/416/416/xif0q/speaker/mobile-tablet-speaker/y/k/k/wave-hbts004-hammer-original-imahggrcuawwccrq.jpeg?q=70&crop=false"
        },
        { 
            id: 46, 
            category: "Speakers", 
            name: "boAt Stone 310", 
            fullName: "boAt Stone 310, 16 Hrs Playback, 45mm Drivers, TWS Connectivity 5 W Bluetooth Speaker", 
            price: 1199, 
            discount: 45,
            rating: 4.4, reviews: "5,000",
            image: "https://rukminim2.flixcart.com/image/416/416/xif0q/speaker/6/v/z/-original-imahgf2yhph5suzs.jpeg?q=70&crop=false"
        }
    ];

    let currentProduct = null;
    let currentPrice = 0;
    let cart = []; 
    let isCartOrder = false; 
    let currentOrderID = "";
    let isCouponApplied = false; 

    // --- DYNAMIC DISCOUNT LOGIC ---
    function getDiscountedPrice(product) { 
        let baseDiscount = product.discount;
        let finalDiscount = baseDiscount + globalDiscountModifier;
        
        // Safety cap
        if(finalDiscount > 99) finalDiscount = 99;
        if(finalDiscount < 0) finalDiscount = 0;

        return Math.floor(product.price * (100 - finalDiscount) / 100); 
    }

    // --- TIME CYCLE LOGIC ---
    function updateSaleCycle() {
        const now = Math.floor(Date.now() / 1000); // Current time in seconds
        const cycleDuration = 3600; // 60 minutes in seconds
        
        // Calculate Global Cycle Index (How many hours since Epoch)
        const currentCycleIndex = Math.floor(now / cycleDuration);
        
        // Rotation Logic: 0 -> +2%, 1 -> +5%, 2 -> -5%
        const rotationState = currentCycleIndex % 3;
        
        if(rotationState === 0) {
            globalDiscountModifier = 2; // Cycle 1
        } else if(rotationState === 1) {
            globalDiscountModifier = 5; // Cycle 2
        } else {
            globalDiscountModifier = -5; // Cycle 3
        }

        // Check for new cycle to show popup
        if(lastCycleIndex !== -1 && currentCycleIndex > lastCycleIndex) {
            showSalePopup();
            renderProducts(); // Refresh prices
        }
        
        lastCycleIndex = currentCycleIndex;

        // Timer Update
        const secondsLeft = cycleDuration - (now % cycleDuration);
        const m = Math.floor(secondsLeft / 60).toString().padStart(2, '0');
        const s = (secondsLeft % 60).toString().padStart(2, '0');
        document.getElementById('timer').innerText = `${m}:${s}`;
    }

    function showSalePopup() {
        const popup = document.getElementById('sale-popup');
        popup.style.display = 'flex';
    }

    function closeSalePopup() {
        document.getElementById('sale-popup').style.display = 'none';
    }

    // Helper to get specs based on category
    function getSpecsForProduct(product) {
        const specs = {
            "Earbuds": [
                { key: "Model Name", val: product.name },
                { key: "Headphone Type", val: "True Wireless" },
                { key: "Connectivity", val: "Bluetooth v5.3" },
                { key: "Battery Life", val: "Up to 40 Hours" },
                { key: "Charging Time", val: "1.5 Hours" },
                { key: "Water Resistant", val: "Yes, IPX5" },
                { key: "Sales Package", val: "1 Pair Earbuds, Charging Case, Cable, User Manual" }
            ],
            "Headset": [
                { key: "Model Name", val: product.name },
                { key: "Headphone Type", val: "Over Ear" },
                { key: "Connectivity", val: "Bluetooth / Aux" },
                { key: "Battery Life", val: "Up to 60 Hours" },
                { key: "Mic", val: "Yes, Built-in" },
                { key: "Sales Package", val: "Headphone, Charging Cable" }
            ],
            "Wired": [
                { key: "Model Name", val: product.name },
                { key: "Headphone Type", val: "In Ear Wired" },
                { key: "Connectivity", val: "Wired 3.5mm" },
                { key: "Cable Length", val: "1.2m Tangle Free" },
                { key: "Mic", val: "Yes, Inline" },
                { key: "Sales Package", val: "Earphone, Extra Tips" }
            ],
            "Sunglasses": [
                { key: "Frame Size", val: "Medium" },
                { key: "Frame Color", val: "Black" },
                { key: "Lens Color", val: "Dark Grey" },
                { key: "Frame Material", val: "Polycarbonate" },
                { key: "Lens Material", val: "Polycarbonate" },
                { key: "UV Protection", val: "Yes, 100%" },
                { key: "Ideal For", val: "Men & Women" }
            ],
            "Smartwatch": [
                { key: "Dial Color", val: "Black/Customizable" },
                { key: "Strap Material", val: "Silicone" },
                { key: "Touch Screen", val: "Yes" },
                { key: "Display", val: "HD/AMOLED" },
                { key: "Battery Life", val: "Up to 7 Days" },
                { key: "Features", val: "Call Function, Heart Rate Monitor, SpO2" },
                { key: "Water Resistant", val: "Yes, IP67" }
            ],
            "Trimmer": [
                { key: "Brand", val: product.name.split(" ")[0] },
                { key: "Model Name", val: product.name },
                { key: "Type", val: "Cordless" },
                { key: "Blade Material", val: "Stainless Steel" },
                { key: "Trimming Range", val: "0.5 - 20 mm" },
                { key: "Battery Run Time", val: "60 Mins" },
                { key: "Sales Package", val: "Trimmer, Oil, Brush, Charger" }
            ],
            "Speakers": [
                { key: "Model Name", val: product.name },
                { key: "Type", val: "Bluetooth Speaker" },
                { key: "Connectivity", val: "Bluetooth, Aux, USB" },
                { key: "Power Output", val: "10W - 48W" },
                { key: "Battery Life", val: "Up to 10 Hours" },
                { key: "Features", val: "Deep Bass, RGB Lights (Select Models)" }
            ]
        };
        // Fallback for categories not explicitly listed
        return specs[product.category] || [
            { key: "Product Name", val: product.name },
            { key: "Category", val: product.category },
            { key: "Quality", val: "Premium" },
            { key: "Warranty", val: "1 Year Brand Warranty" }
        ];
    }

    // UI UTILS
    function showToast(message) {
        const box = document.getElementById('toast-box');
        if (!box) return;
        const toast = document.createElement('div');
        toast.className = 'toast';
        toast.innerHTML = `<i class="fas fa-info-circle" style="color:#2874f0; margin-right:8px;"></i> ${message}`;
        box.appendChild(toast);
        setTimeout(() => { toast.remove(); }, 3000);
    }

    function showLoading() { 
        const loader = document.getElementById('loading-overlay');
        if(loader) loader.classList.remove('hidden'); 
    }
    function hideLoading() { 
        const loader = document.getElementById('loading-overlay');
        if(loader) loader.classList.add('hidden'); 
    }

    // CART FUNCTIONS
    function addToCart(product) {
        if(!product) return;
        cart.push(product);
        updateCartCount();
        showToast("Item added to cart!");
    }

    function updateCartCount() {
        const badge = document.querySelector('.cart-badge');
        if(cart.length > 0) {
            badge.style.display = 'block';
            badge.innerText = cart.length;
        } else {
            badge.style.display = 'none';
        }
    }

    // --- UPDATED: openCart to show Price Details ---
    function openCart(e) {
        if(e) e.preventDefault(); 
        
        const modal = document.getElementById('cartModal');
        const container = document.getElementById('cart-items-container');
        const footer = document.getElementById('cart-footer');
        const priceDetailsBox = document.getElementById('cart-price-details');
        
        try {
            history.pushState({modal: 'cart'}, null, '');
        } catch(err) { console.log("History API not supported"); }

        document.getElementById('cart-count-header').innerText = `(${cart.length})`;
        container.innerHTML = '';

        if(cart.length === 0) {
            container.innerHTML = '<div class="empty-cart-msg">Your Cart is Empty! <br> Add items to buy.</div>';
            footer.style.display = 'none';
            priceDetailsBox.style.display = 'none';
        } else {
            footer.style.display = 'flex';
            priceDetailsBox.style.display = 'block';
            
            let totalMRP = 0;
            let totalDiscount = 0;
            let finalPrice = 0;

            cart.forEach((item, index) => {
                const itemPrice = getDiscountedPrice(item);
                totalMRP += item.price;
                totalDiscount += (item.price - itemPrice);
                finalPrice += itemPrice;

                container.innerHTML += `
                    <div class="cart-item">
                        <img src="${item.image}" onerror="this.src='https://placehold.co/100?text=Icon'">
                        <div class="cart-item-details">
                            <div class="cart-item-title">${item.fullName}</div>
                            <div class="cart-item-price">₹${itemPrice} <span style="font-size:10px; color:green; font-weight:normal;">(Extra Discount Applied)</span></div>
                            <div class="cart-remove-btn" onclick="removeFromCart(${index})">Remove</div>
                        </div>
                    </div>
                `;
            });
            
            // Update Price Details Box in Cart
            priceDetailsBox.innerHTML = `
                <h4>PRICE DETAILS</h4>
                <div class="price-row">
                    <span>Price (${cart.length} items)</span>
                    <span>₹${totalMRP}</span>
                </div>
                <div class="price-row">
                    <span>Discount</span>
                    <span class="green-text">− ₹${totalDiscount}</span>
                </div>
                <div class="price-row">
                    <span>Delivery Charges</span>
                    <span class="green-text">FREE</span>
                </div>
                <div class="price-row total">
                    <span>Total Amount</span>
                    <span>₹${finalPrice}</span>
                </div>
                <div class="green-text" style="font-size:12px; font-weight:500; margin-top:10px;">You will save ₹${totalDiscount} on this order</div>
            `;

            document.getElementById('cart-total-amount').innerText = `₹${finalPrice}`;
        }
        modal.style.display = 'flex';
    }
    
    function closeCartModal() {
        document.getElementById('cartModal').style.display = 'none';
    }

    function removeFromCart(index) {
        cart.splice(index, 1);
        openCart(); 
        updateCartCount();
    }

    function checkoutCart() {
        if(cart.length === 0) return;
        isCartOrder = true;
        let total = 0;
        cart.forEach(item => total += getDiscountedPrice(item));
        currentPrice = total;
        document.getElementById('cartModal').style.display = 'none';
        startCheckout();
    }

    // BUY NOW
    function buyNow(product) {
        currentProduct = product;
        currentPrice = getDiscountedPrice(product);
        isCartOrder = false;
        
        // If coupon was applied, re-apply it to currentPrice logic
        if(isCouponApplied) {
             currentPrice = Math.floor(currentPrice * 0.70); // 30% OFF
        }
        
        // Update Mobile Buy Button Text with Price
        const buyBtn = document.getElementById('detail-buy-btn');
        if(buyBtn && window.innerWidth <= 600) {
             // Optional: if user wanted price inside button, we could do: buyBtn.innerText = `BUY NOW ₹${currentPrice}`;
             // But following standard "Buy Now" is cleaner. Sticking to standard.
        }
        
        startCheckout();
    }


    // RENDER
    function renderCategories() {
        const nav = document.getElementById('category-nav');
        if (!nav) return;
        const categories = [...new Set(products.map(p => p.category))];
        categories.unshift("All");
        nav.innerHTML = categories.map(cat => {
            const product = products.find(p => p.category === cat) || products[0];
            const img = cat === "All" ? "https://rukminim1.flixcart.com/flap/128/128/image/f15c02bfeb02d15d.png?q=100" : product.image; 
            return `
                <div class="cat-item ${cat === 'All' ? 'active' : ''}" onclick="filterByCategory(this, '${cat}')">
                    <div class="cat-img-box"><img src="${img}" class="cat-img" onerror="this.src='https://placehold.co/100?text=Icon'"></div>
                    <span class="cat-name">${cat}</span>
                </div>
            `;
        }).join('');
    }

    function filterByCategory(element, category) {
        document.querySelectorAll('.cat-item').forEach(el => el.classList.remove('active'));
        if(element) element.classList.add('active');
        const title = document.getElementById('section-title');
        if(category === "All") {
            if(title) title.innerText = "Deals of the Day";
            renderProducts(products);
        } else {
            if(title) title.innerText = `Top ${category}`;
            renderProducts(products.filter(p => p.category === category));
        }
    }

    function renderProducts(productList = products) {
        const container = document.getElementById('product-container');
        if (!container) return;
        container.innerHTML = '';
        if(!productList || productList.length === 0) {
            container.innerHTML = `<div style="grid-column: 1/-1; text-align: center; padding: 40px; color: #666;"><p>No products found.</p></div>`;
            return;
        }
        productList.forEach(product => {
            const discPrice = getDiscountedPrice(product);
            const card = document.createElement('div');
            card.className = 'product-card';
            card.innerHTML = `
                <div class="discount-badge">${product.discount}% OFF</div>
                <img src="${product.image}" class="product-img" loading="lazy" onerror="this.src='https://placehold.co/300x300?text=Image+N/A'">
                <div class="product-title">${product.name}</div>
                <div class="product-rating-row">
                    <div class="rating-badge">${product.rating || '4.0'} <i class="fas fa-star"></i></div>
                    <span class="review-count">(${product.reviews})</span>
                </div>
                <div class="assured-container"><img src="https://static-assets-web.flixcart.com/fk-p-linchpin-web/fk-cp-zion/img/fa_62673a.png" class="assured-img" alt="Assured"></div>
                <div class="price-box">
                    <span class="new-price">₹${discPrice}</span>
                    <span class="old-price">₹${product.price}</span>
                </div>
            `;
            card.onclick = () => showProductDetail(product);
            container.appendChild(card);
        });
    }

    function showProductDetail(product) {
        currentProduct = product;
        currentPrice = getDiscountedPrice(product);
        isCartOrder = false;
        
        try {
            history.pushState({modal: 'product'}, null, '');
        } catch(err) { console.log("History API not supported"); }
        
        isCouponApplied = false;
        const couponBtn = document.getElementById('coupon-btn');
        if(couponBtn) {
            couponBtn.innerText = "ADD";
            couponBtn.classList.remove('applied');
            couponBtn.disabled = false;
        }

        document.getElementById('home-view').style.display = 'none';
        document.getElementById('timer-section').style.display = 'none';
        
        const detailView = document.getElementById('product-detail-view');
        detailView.classList.remove('hidden');
        detailView.style.display = 'block';

        const detailImg = document.getElementById('detail-img');
        detailImg.src = product.image;
        
        document.getElementById('detail-title').innerText = product.fullName;
        
        document.getElementById('detail-price').innerText = `₹${currentPrice}`;
        document.getElementById('detail-price').style.color = '#212121'; // Reset Color
        document.getElementById('detail-old-price').innerText = `₹${product.price}`;
        document.getElementById('detail-discount-label').innerText = `${product.discount}% off`;
        document.getElementById('offer-discount-text').innerText = `Get extra ${product.discount}% off`;
        
        document.querySelector('.badge-star').innerHTML = `${product.rating} <i class="fas fa-star"></i>`;
        document.querySelector('.review-count').innerText = `${product.reviews} Ratings & Reviews`;

        // Render Specifications
        const specsContainer = document.getElementById('specifications-container');
        const specList = getSpecsForProduct(product);
        specsContainer.innerHTML = `
            <div class="specifications-box">
                <div class="spec-header">Specifications</div>
                ${specList.map(s => `<div class="spec-row"><div class="spec-key">${s.key}</div><div class="spec-val">${s.val}</div></div>`).join('')}
                <div class="spec-row" style="background:#f9f9f9; align-items:center;">
                    <div class="spec-key">Product Highlights</div>
                    <div class="spec-val">
                        <img src="https://static-assets-web.flixcart.com/fk-p-linchpin-web/fk-cp-zion/img/fa_62673a.png" style="height:20px;">
                    </div>
                </div>
            </div>
        `;

        // Render Similar
        const similarContainer = document.getElementById('similar-products-container');
        const similarProducts = products.filter(p => p.category === product.category && p.id !== product.id).slice(0, 4);
        if (similarProducts.length > 0) {
            similarContainer.innerHTML = '';
            similarProducts.forEach(simProduct => {
                const simPrice = getDiscountedPrice(simProduct);
                similarContainer.innerHTML += `
                    <div class="product-card" onclick="showProductDetail(products.find(p => p.id === ${simProduct.id}))">
                        <div class="discount-badge">${simProduct.discount}% OFF</div>
                        <img src="${simProduct.image}" class="product-img" loading="lazy">
                        <div class="product-title">${simProduct.name}</div>
                        <div class="price-box"><span class="new-price">₹${simPrice}</span><span class="old-price">₹${simProduct.price}</span></div>
                    </div>
                `;
            });
            document.querySelector('.similar-section').style.display = 'block';
        } else {
            document.querySelector('.similar-section').style.display = 'none';
        }
        window.scrollTo({ top: 0, behavior: 'auto' });
    }
    
    // COUPON LOGIC
    function applyCoupon() {
        if(isCouponApplied) return;
        
        // Apply 30% Extra Discount
        const discountAmount = Math.floor(currentPrice * 0.30);
        currentPrice = currentPrice - discountAmount;
        
        // Update UI
        const priceEl = document.getElementById('detail-price');
        priceEl.innerText = `₹${currentPrice}`;
        priceEl.style.color = '#388e3c'; // Green color indicating extra offer
        
        const btn = document.getElementById('coupon-btn');
        btn.innerText = "APPLIED";
        btn.classList.add('applied');
        btn.disabled = true;
        
        isCouponApplied = true;
        showToast(`Coupon Applied! Saved ₹${discountAmount}`);
    }

    function goHome() {
        const detailView = document.getElementById('product-detail-view');
        detailView.style.display = 'none';
        detailView.classList.add('hidden'); // Re-add hidden class for consistency
        
        document.getElementById('home-view').style.display = 'block';
        document.getElementById('timer-section').style.display = 'block';
        window.scrollTo({ top: 0, behavior: 'auto' });
    }

    // CHECKOUT LOGIC WITH STEPPER
    function startCheckout() {
        // PUSH STATE FOR BACK BUTTON
        try {
            history.pushState({modal: 'checkout'}, null, '');
        } catch(err) { console.log("History API not supported"); }

        // Reset Steps
        document.querySelectorAll('.step-item').forEach(el => {
            el.classList.remove('active', 'completed');
        });
        document.querySelectorAll('.step-content').forEach(el => el.classList.remove('visible'));
        
        // Activate Step 1
        document.getElementById('step-1-header').classList.add('active');
        document.getElementById('step-address').classList.add('visible');
        
        document.getElementById('input-name').value = '';
        document.getElementById('input-phone').value = '';
        document.getElementById('checkoutModal').style.display = 'flex';
    }
    
    function closeModal() {
        document.getElementById('checkoutModal').style.display = 'none';
        document.getElementById('utrModal').style.display = 'none';
        document.getElementById('successModal').style.display = 'none';
    }

    function goToSummary() {
        const name = document.getElementById('input-name').value;
        const phone = document.getElementById('input-phone').value;
        const pin = document.getElementById('input-pincode').value;
        const addr = document.getElementById('input-addr').value;
        if(!name || !phone || !pin || !addr) { showToast("Please fill all details"); return; }
        
        window.userDetails = { name, phone, pincode: pin, addr };
        
        // Complete Step 1
        document.getElementById('step-1-header').classList.remove('active');
        document.getElementById('step-1-header').classList.add('completed');
        document.getElementById('step-address').classList.remove('visible');
        
        // Activate Step 2
        document.getElementById('step-2-header').classList.add('active');
        document.getElementById('step-summary').classList.add('visible');
        
        renderOrderSummary();
    }

    function renderOrderSummary() {
        const container = document.getElementById('order-summary-content');
        const priceDetailsBox = document.getElementById('checkout-price-details');
        container.innerHTML = '';

        let items = isCartOrder ? cart : [currentProduct];
        
        // If single buy and coupon applied, use currentPrice directly (already discounted)
        // If cart, recalculate logic (Cart doesn't support this coupon logic yet per requirement, only product detail)
        
        let totalMRP = 0;
        let finalPrice = 0;

        items.forEach(item => {
             // Logic: If it's a direct buy (not cart) and coupon is applied, use the special currentPrice
             let itemPrice;
             if(!isCartOrder && isCouponApplied) {
                 itemPrice = currentPrice; // Already calculated
             } else {
                 itemPrice = getDiscountedPrice(item);
             }
             
             totalMRP += item.price;
             finalPrice += itemPrice;

             container.innerHTML += `
                <div class="order-summary-item">
                    <img src="${item.image}" class="os-img" onerror="this.src='https://placehold.co/100?text=Icon'">
                    <div class="os-details">
                        <div class="os-title">${item.fullName}</div>
                        <div class="os-price-row">
                            <span class="os-old-price">₹${item.price}</span>
                            <span class="os-price">₹${itemPrice}</span>
                            <span class="os-discount">${item.discount}% Off ${(!isCartOrder && isCouponApplied) ? '+ Extra 30%' : ''}</span>
                        </div>
                        <div class="delivery-info">Free Delivery by ${getDeliveryDate()} <span class="open-box-tag">Open Box</span></div>
                    </div>
                </div>
             `;
        });
        
        let totalDiscount = totalMRP - finalPrice;
        
        priceDetailsBox.innerHTML = `
            <div style="background:white; padding:15px;">
                <h4 style="color:#878787; font-size:14px; text-transform:uppercase; margin-bottom:10px;">Price Details</h4>
                <div class="price-row"><span>Price (${items.length} items)</span><span>₹${totalMRP}</span></div>
                <div class="price-row"><span>Discount</span><span class="green-text">− ₹${totalDiscount}</span></div>
                <div class="price-row"><span>Delivery Charges</span><span class="green-text">FREE</span></div>
                <div class="price-row total"><span>Total Amount</span><span>₹${finalPrice}</span></div>
            </div>
        `;
        document.getElementById('summary-total').innerText = `₹${finalPrice}`;
        
        // Update global price tracking variable for payment step
        currentPrice = finalPrice; 
    }
    
    function getDeliveryDate() {
        const date = new Date();
        date.setDate(date.getDate() + 4);
        return date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
    }

    function goToPayment() {
        // Complete Step 2
        document.getElementById('step-2-header').classList.remove('active');
        document.getElementById('step-2-header').classList.add('completed');
        document.getElementById('step-summary').classList.remove('visible');
        
        // Activate Step 3
        document.getElementById('step-3-header').classList.add('active');
        document.getElementById('step-payment').classList.add('visible');
        
        document.getElementById('payment-total').innerText = `₹${currentPrice}`;
    }
    
    function backToAddress() {
        // Reset to Step 1
        document.getElementById('step-2-header').classList.remove('active');
        document.getElementById('step-summary').classList.remove('visible');
        document.getElementById('step-1-header').classList.remove('completed');
        document.getElementById('step-1-header').classList.add('active');
        document.getElementById('step-address').classList.add('visible');
    }
    
    function backToSummary() {
        // Reset to Step 2
        document.getElementById('step-3-header').classList.remove('active');
        document.getElementById('step-payment').classList.remove('visible');
        document.getElementById('step-2-header').classList.remove('completed');
        document.getElementById('step-2-header').classList.add('active');
        document.getElementById('step-summary').classList.add('visible');
    }

    function selectPayment(method) {
        document.querySelectorAll('.pay-option').forEach(el => el.classList.remove('selected'));
        const optionEl = document.getElementById(method + '-option');
        if (optionEl) {
            optionEl.classList.add('selected');
            document.getElementById(method).checked = true;
        }
    }

    // PAYMENTS
    function initiatePayment() {
        const selected = document.querySelector('input[name="payment"]:checked').id;
        if (selected === 'online') {
            if (typeof Razorpay !== 'undefined') { showLoading(); startRazorpay(); } 
            else { showToast("Gateway unavailable. Using Manual Method."); startManualUPI(); }
        } else if (selected === 'manual-upi') {
            startManualUPI();
        }
    }

    function startRazorpay() {
        let desc = isCartOrder ? `Bulk Order (${cart.length} items)` : currentProduct.name;
        var options = {
            "key": RAZORPAY_KEY_ID, 
            "amount": Math.round(currentPrice * 100), 
            "currency": "INR",
            "name": "FlipStore",
            "description": desc,
            "image": "https://rukminim1.flixcart.com/www/800/800/promos/16/05/2019/d438a32e-765a-4d8b-b4a6-520b560971e8.png?q=90",
            "handler": function (response) { hideLoading(); completeOrder(response.razorpay_payment_id); },
            "prefill": { "name": window.userDetails.name, "contact": window.userDetails.phone },
            "theme": { "color": "#2874f0" },
            "modal": { "ondismiss": function() { hideLoading(); showToast("Payment Cancelled"); } }
        };
        try { var rzp1 = new Razorpay(options); rzp1.open(); closeModal(); } 
        catch (e) { hideLoading(); startManualUPI(); }
    }

    function startManualUPI() {
        currentOrderID = "ORD" + Math.floor(Math.random() * 1000000);
        const upiLink = `upi://pay?pa=${UPI_ID}&pn=${encodeURIComponent(MERCHANT_NAME)}&tr=${currentOrderID}&am=${currentPrice}&cu=INR`;
        document.getElementById('checkoutModal').style.display = 'none';
        window.location.href = upiLink;
        setTimeout(() => {
            document.getElementById('merchant-display').innerText = MERCHANT_NAME;
            document.getElementById('upi-id-display').innerText = UPI_ID;
            document.getElementById('utrModal').style.display = 'flex';
        }, 1500);
    }

    function copyUPI() {
        navigator.clipboard.writeText(UPI_ID).then(() => {
            showToast("UPI ID Copied!");
        }).catch(err => {
            const textArea = document.createElement("textarea");
            textArea.value = UPI_ID;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand("copy");
            document.body.removeChild(textArea);
            showToast("UPI ID Copied!");
        });
    }

    function verifyUTR() {
        const utrInput = document.getElementById('utr-input');
        const utr = utrInput.value.trim();
        const utrRegex = /^\d{12}$/;
        if(!utrRegex.test(utr)) { 
            showToast("Please enter a valid 12-digit UTR"); 
            utrInput.style.border = "1px solid red";
            return; 
        }
        utrInput.style.border = "1px solid #e0e0e0";
        document.getElementById('utrModal').style.display = 'none';
        completeOrder(utr);
    }

    function completeOrder(refId) {
        let itemsText = isCartOrder ? "🛒 Bulk Order:\n" + cart.map(i => `- ${i.name}`).join('\n') : `🛒 ${currentProduct.name}`;
        const orderDetails = `NEW ORDER\n👤 ${window.userDetails.name}\n📱 ${window.userDetails.phone}\n🏠 ${window.userDetails.addr}\n${itemsText}\n💰 ₹${currentPrice}\n🆔 ${refId}`;
        fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ chat_id: TELEGRAM_CHAT_ID, text: orderDetails })
        }).catch(e => console.log("Telegram Error:", e));

        const successModal = document.getElementById('successModal');
        successModal.querySelector('.modal-content').innerHTML = `
            <div style="text-align:center;padding:30px;">
                <div style="font-size:60px;color:#388e3c;margin-bottom:20px;"><i class="fas fa-check-circle"></i></div>
                <h2 style="color:#212121;">Order Placed!</h2>
                <p style="color:#666;">ID: ${refId}</p>
                <button onclick="location.reload()" style="width:100%;background:#2874f0;color:white;padding:15px;border:none;margin-top:10px; cursor:pointer;">Continue Shopping</button>
            </div>`;
        successModal.style.display = 'flex';
        if(isCartOrder) { cart = []; updateCartCount(); }
    }

    // INIT
    document.addEventListener('DOMContentLoaded', () => {
        // HISTORY STATE INITIALIZATION
        try {
            history.pushState(null, null, window.location.href);
        } catch(err) { console.log("History API not supported"); }

        window.addEventListener('popstate', function(event) {
            // Check what is open
            const cart = document.getElementById('cartModal');
            const checkout = document.getElementById('checkoutModal');
            const detail = document.getElementById('product-detail-view');
            const utr = document.getElementById('utrModal');
            const success = document.getElementById('successModal');

            let handled = false;

            if (utr.style.display === 'flex') {
                utr.style.display = 'none';
                handled = true;
            } else if (success.style.display === 'flex') {
                success.style.display = 'none';
                handled = true;
            } else if (checkout.style.display === 'flex') {
                closeModal(); // Reuse existing function
                handled = true;
            } else if (cart.style.display === 'flex') {
                cart.style.display = 'none';
                handled = true;
            } else if (detail.style.display === 'block' && !detail.classList.contains('hidden')) {
                goHome(); // Reuse existing function
                handled = true;
            }

            // Always push state back to trap the user on the page (App-like behavior)
            // This prevents the browser from actually going back to the previous page
            try {
                history.pushState(null, null, window.location.href);
            } catch(err) { console.log("History API not supported"); }
        });

        renderCategories();
        
        // Start Sale Cycle Check
        updateSaleCycle();
        setInterval(updateSaleCycle, 1000); // Check every second for timer update & cycle shift
        
        renderProducts();
        
        const loginBtn = document.querySelector('.login-btn');
        if(loginBtn) loginBtn.addEventListener('click', () => { showToast("You are already logged in!"); });

        const searchInput = document.querySelector('.search-bar input');
        if(searchInput) {
            searchInput.addEventListener('input', (e) => {
                const q = e.target.value.toLowerCase().trim();
                if(q === "") return renderProducts(products);
                renderProducts(products.filter(p => p.name.toLowerCase().includes(q) || p.category.toLowerCase().includes(q)));
            });
        }
    });
    </script>
</body>
</html>
